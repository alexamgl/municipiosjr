<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>Municipio San Juan del Río</title>
    <style>
        .contenedor{
            text-align: center;

        }

        .contenedor h1{
            color: #0b3b59;
        }
    </style>
</head>


<body>

<!-- Aquí se cargará el navbar -->
<div id="navbarContainer"></div>

    <style>

        .progress-bar {
            background-color: #ef5196;
        }
        .step-title {
            font-weight: bold;
            text-transform: uppercase;
            color: #0b3b59;
        }
        .form-step {
            display: none;
        }
        .form-step.active {
            display: block;
        }
        .btn-primary {
            background-color: #0b3b59;;
            border: none;
        }
        .btn-primary:hover {
            background-color: #0056b3;
        }
        .modal-header {
            background-color: #007bff;
            color: white;
        }
    </style>

<br>
<br>

<div class="container mt-5">
    <h1 class="text-center mb-4">
        <span style="color: #0b3b59;">Formulario de Denuncia</span>
        <span style="color: #ef5196;">Ciudadana</span>
    </h1>
    
    <!-- Barra de progreso -->
    <div class="progress mb-4">
        <div class="progress-bar" role="progressbar" style="width: 16%;" id="progressBar" aria-valuenow="16" aria-valuemin="0" aria-valuemax="100"></div>
    </div>

    <!-- Formulario -->
    <form id="denunciaForm" name="denunciaForm" enctype="multipart/form-data">

        <!-- Paso 1 -->
        <div class="form-step active" id="step1">
            <h4 class="step-title">Paso 1: Tipo de Promoción</h4>
            <div class="mb-3">
                <label for="tipoPromocion" class="form-label">Tipo de Promoción</label>
                <select class="form-select" id="tipoPromocion" required>
                    <option hidden="" value="">Seleccione...</option>
                    <option value="Denuncia">Denuncia</option>
                    <option value="Queja">Queja</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="dependencia" class="form-label">Dependencia</label>
                <select class="form-select" id="dependencia" required>
                    <option value="" hidden="">Seleccione...</option>
                    <option value="Secretaría Particular">Secretaría Particular</option>
                    <option value="Secretaría de Gobierno">Secretaría de Gobierno</option>
                    <option value="Secretaría de Administracion">Secretaría de Administracion</option>
                    <option value="Secretaría de Seguridad Publica">Secretaría de Seguridad Publica</option>
                    <option value="Secretaría de Obras Publicas y Desarrollo Urbano">Secretaría de Obras Publicas y Desarrollo Urbano</option>
                    <option value="Secretaría de Desarrollo Social">Secretaría de Desarrollo Social</option>
                    <option value="Secretaría de Ayuntamiento">Secretaría de Ayuntamiento</option>
                    <option value="Secretaría de Finanzas">Secretaría de Finanzas</option>
                    <option value="Dependencia 2">Secretaría de Desarrollo Integral y Economico</option>
                    <option value="Dependencia 2">Secretaría de Desarrollo Agropecuario</option>
                    <option value="Dependencia 2">Secretaría de Organo Interno y de Control</option>
                    <option value="Dependencia 2">Secretaría de Servicio Publicos Municipales</option>
                </select>
            </div>
            <button type="button" class="btn btn-primary float-end" onclick="nextStep()">Siguiente</button>
        </div>

        <!-- Paso 2 -->
        <div class="form-step" id="step2">
            <h4 class="step-title">Paso 2: Datos de la Persona que Presenta la Denuncia</h4>
            
            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="anonimo" onchange="toggleAnonimo()">
                <label class="form-check-label" for="anonimo">¿Desea permanecer anónimo?</label>
            </div>
            
            <div id="datosPersona">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="nombre" class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="nombre" placeholder="Nombre">
                        </div>
                        <div class="mb-3">
                            <label for="apellidos" class="form-label">Apellidos</label>
                            <input type="text" class="form-control" id="apellido" placeholder="Apellidos">
                        </div>
                        <div class="mb-3">
                            <label for="calle" class="form-label">Calle</label>
                            <input type="text" class="form-control" id="calle" placeholder="Calle">
                        </div>
                        <div class="mb-3">
                            <label for="numeroExterior" class="form-label">Número Exterior</label>
                            <input type="text" class="form-control" id="numeroExterior" placeholder="Número Exterior (Opcional)">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="numeroInterior" class="form-label">Número Interior</label>
                            <input type="text" class="form-control" id="numeroInterior" placeholder="Número Interior">
                        </div>
                        <div class="mb-3">
                            <label for="colonia" class="form-label">Colonia</label>
                            <input type="text" class="form-control" id="colonia" placeholder="Colonia">
                        </div>
                        <div class="mb-3">
                            <label for="correo" class="form-label">Correo Electrónico</label>
                            <input type="email" class="form-control" id="correo" placeholder="Correo Electrónico">
                        </div>
                        <div class="mb-3">
                            <label for="telefono" class="form-label">Teléfono</label>
                            <input 
                                type="tel" 
                                class="form-control" 
                                id="telefono" 
                                placeholder="Teléfono" 
                                maxlength="10" 
                                pattern="\d{10}" 
                                oninput="validatePhone(this)">
                            <div class="invalid-feedback">Debe ser un número de 10 dígitos.</div>
                        </div>
                        
                    </div>
                </div>
            </div>
            <button type="button" class="btn btn-secondary" onclick="previousStep()">Anterior</button>
            <button type="button" class="btn btn-primary float-end" onclick="nextStep()">Siguiente</button>
        </div>
        
        <script>
            function toggleAnonimo() {
                const anonimo = document.getElementById("anonimo").checked;
                const datosPersona = document.querySelectorAll("#datosPersona input");
        
                datosPersona.forEach(input => {
                    input.disabled = anonimo; // Deshabilita o habilita los campos según el estado de "anónimo"
                    input.value = anonimo ? "" : input.value; // Limpia los campos si está en modo "anónimo"
                });
            }

            function validatePhone(input) {
				// Elimina cualquier carácter que no sea un número
				input.value = input.value.replace(/\D/g, '');

				// Verifica si la longitud es mayor a 10 y la corta si es necesario
				if (input.value.length > 10) {
					input.value = input.value.slice(0, 10);
				}

				// Verifica si es válido (10 dígitos)
				if (input.value.length === 10) {
					input.classList.remove("is-invalid");
					input.classList.add("is-valid");
				} else {
					input.classList.remove("is-valid");
					input.classList.add("is-invalid");
				}
			}
        </script>
        
        <!-- Paso 3 -->
        <div class="form-step" id="step3">
            <h4 class="step-title">Paso 3: Datos del Servidor Público Involucrado</h4>
            <div class="mb-3">
                <label for="sexo" class="form-label">Sexo</label>
                <select class="form-select" id="sexo" required>
                    <option hidden="">Seleccione...</option>
                    <option value="Femenino">Femenino</option>
                    <option value="Masculino">Masculino</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="nombreServidor" class="form-label">Nombre del Servidor</label>
                <input type="text" class="form-control" id="nombreServidor" placeholder="Nombre del Servidor" required>
            </div>
            <div class="mb-3">
                <label for="apellidoServidor" class="form-label">Apellido Paterno del Servidor</label>
                <input type="text" class="form-control" id="apellidoServidorP" placeholder="Apellidos del Servidor" required>
            </div>
            <div class="mb-3">
                <label for="apellidoServidor" class="form-label">Apellido Materno del Servidor</label>
                <input type="text" class="form-control" id="apellidoServidorM" placeholder="Apellidos del Servidor" required>
            </div>
            <div class="mb-3">
                <label for="cargo" class="form-label">Cargo del Servidor Público</label>
                <input type="text" class="form-control" id="cargo" placeholder="Cargo del Servidor Público" required>
            </div>
            <button type="button" class="btn btn-secondary" onclick="previousStep()">Anterior</button>
            <button type="button" class="btn btn-primary float-end" onclick="nextStep()">Siguiente</button>
        </div>

        <!-- Paso 4 -->
        <div class="form-step" id="step4">
            <h4 class="step-title">Paso 4: Datos de la Denuncia</h4>
            <div class="mb-3">
                <label for="motivo" class="form-label">Motivo de Denuncia</label>
                <textarea class="form-control" id="motivo" rows="4" required placeholder="Explique brevemente el motivo de su denuncia"></textarea>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="fechaHechos" class="form-label">Fecha en que ocurrieron los hechos</label>
                        <input type="date" class="form-control" required id="fechaHechos">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="horaHechos" class="form-label">Hora en que ocurrieron los hechos</label>
                        <input type="time" class="form-control" id="horaHechos">
                    </div>
                </div>
            </div>
            <div class="mb-3">
                <label for="lugarHechos" class="form-label">¿Dónde sucedieron los hechos?</label>
                <input type="text" class="form-control" id="lugarHechos" required placeholder="Especifique la ubicación de los hechos">
            </div>
            <div class="mb-3">
                <label for="evidencias" class="form-label">Evidencias de los hechos</label>
                <input type="file" class="form-control" id="evidencias" multiple>
                <small class="text-muted">Puede cargar imágenes, videos u otros documentos relacionados.</small>
            </div>
            <div class="mb-3">
                <label for="descripcionHechos" class="form-label">Describa los hechos de manera clara y concisa</label>
                <textarea class="form-control" id="descripcionHechos" required rows="5" placeholder="Proporcione una descripción detallada de los hechos"></textarea>
            </div>
            <button type="button" class="btn btn-secondary" onclick="previousStep()">Anterior</button>
            <button type="button" class="btn btn-primary float-end" onclick="nextStep()">Siguiente</button>
        </div>

        <!-- Paso 5 -->
        <div class="form-step" id="step5">
            <h4 class="step-title">Paso 5: Confirmación</h4>

         

		
        
            <!-- Checkbox para el aviso de privacidad -->
            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="avisoPrivacidad" required>
                <label class="form-check-label" for="avisoPrivacidad">
                    Acepto el <a href="#" data-bs-toggle="modal" data-bs-target="#modalAvisoPrivacidad">aviso de privacidad</a>.
                </label>
            </div>
        
            <!-- Botones -->
            <button type="button" class="btn btn-secondary" onclick="previousStep()">Anterior</button>
            <button type="submit" class="btn btn-primary float-end">Enviar</button>
        </div>

        <script>
            function onClick(e) {
              e.preventDefault();
              
              const termsCheckbox = document.getElementById('avisoPrivacidad');
              
              if (termsCheckbox.checked) {
                grecaptcha.ready(function() {
					grecaptcha.execute('6LfA_IMqAAAAACqsjZRjjPqwZe4ubnRpnOtMZ8o-', { action: 'submit' }).then(function(token) {
                    // Aquí añades la lógica para enviar el formulario a tu servidor con el token.
                    document.getElementById("denunciaForm").submit();
                  });
                });
              } else {
                alert("Debes aceptar los términos y condiciones antes de continuar.");
              }
            }
        </script>
        
        <!-- Modal del Aviso de Privacidad -->
        <div class="modal fade" id="modalAvisoPrivacidad" tabindex="-1" aria-labelledby="modalAvisoPrivacidadLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalAvisoPrivacidadLabel">Aviso de Privacidad</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body">
                        <p>
                            Aquí va el texto completo del aviso de privacidad. Puedes incluir información sobre cómo se manejarán los datos recopilados en este formulario, cumpliendo con las leyes de protección de datos aplicables.
                        </p>
                        <p>
                            Asegúrate de ser claro y transparente sobre el uso de los datos y proporcionar información de contacto en caso de que el usuario tenga preguntas.
                        </p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Mensajes de Validación -->
		<div class="msg mt-3 mb-3"></div>
    </form>
</div>

<br>
<br>

<script>
    let currentStep = 0;
    const steps = document.querySelectorAll(".form-step");
    const progressBar = document.getElementById("progressBar");

    function showStep(index) {
        steps.forEach((step, i) => {
            step.classList.toggle("active", i === index);
        });
        progressBar.style.width = `${(index + 1) * 100 / steps.length}%`;
    }

    function nextStep() {
    const currentStepElement = steps[currentStep];
    const requiredFields = currentStepElement.querySelectorAll("[required]");

    let isValid = true;
    requiredFields.forEach(field => {
        if (!field.value.trim()) {
            isValid = false;
            field.classList.add("is-invalid"); // Agrega una clase para mostrar el error
        } else {
            field.classList.remove("is-invalid"); // Elimina la clase si el campo es válido
        }
    });

    if (!isValid) {
        alert("Por favor, complete todos los campos obligatorios antes de continuar.");
        return; // Evita avanzar al siguiente paso
    }

    if (currentStep < steps.length - 1) currentStep++;
    showStep(currentStep);
}


    function previousStep() {
        if (currentStep > 0) currentStep--;
        showStep(currentStep);
    }

    /*document.getElementById("denunciaForm").addEventListener("submit", (e) => {
        e.preventDefault();
        alert("Formulario enviado. ¡Gracias!");
        currentStep = 0;
        showStep(currentStep);
    });*/
	
	$(function(){
		$("#denunciaForm").on("submit", function(e){
				  
			// Cancelamos el evento si se requiere 
			e.preventDefault();
	 
			// Obtenemos los datos del formulario 
			var f = $(this);
			var formData = new FormData(document.getElementById("denunciaForm"));
			formData.append("dato", "valor");
				   
			// Enviamos los datos al archivo PHP que procesará el envio de los datos a un determinado correo 
			$.ajax({
				url: "submit_denuncia.php",
				type: "post",
				dataType: "json",
				data: formData,
				cache: false,
				contentType: false,
				processData: false,
				beforeSend: function() {
				  $('.msg').html("<img src='images/load.gif' />");
				},
			})
	 
			// Cuando el formulario es enviado, mostramos un mensaje en la vista HTML 
			// En el archivo enviarcorreo.php devuelvo el valor '1' el cual es procesado con jQuery Ajax 
			// y significa que el mensaje se envio satisfactoriamente. 
			.done(function (res) {
				if(res.a == "1"){
					// Mostramos el mensaje 'Tu Mensaje ha sido enviado Correctamente !' 
					$(".msg").html(res.b);
					$("#denunciaForm").trigger("reset");
					currentStep = 0;
					showStep(currentStep);
				} else {
					$(".msg").html(res.b); 
				}
			})
	 
			// Mensaje de error al enviar el formulario 
			.fail(function (res) {                    
				$(".msg").html(res.b);
			});	 
		});
	});

    showStep(currentStep);
</script>



<div id="footerContainer"></div>


<script>
    fetch('partials/navbar.html')
        .then(response => response.text())
        .then(data => {
            document.getElementById('navbarContainer').innerHTML = data;
        })
        .catch(error => console.error('Error al cargar el navbar:', error));
    fetch('partials/footer.html')
        .then(response => response.text())
        .then(data => {
            document.getElementById('footerContainer').innerHTML = data;
        })
        .catch(error => console.error('Error al cargar el footer:', error));
</script>
<script>
    // Mostrar u ocultar el botón "Back to Top"
    window.onscroll = function() {
        const backToTopButton = document.getElementById('backToTop');
        if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
            backToTopButton.style.display = "block";
        } else {
            backToTopButton.style.display = "none";
        }
    };

    // Función para desplazarse suavemente hacia arriba
    document.getElementById('backToTop').onclick = function() {
        window.scrollTo({top: 0, behavior: 'smooth'});
    };

</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
<script src="https://www.google.com/recaptcha/api.js"></script>
<script src="https://www.google.com/recaptcha/api.js?render=6LfA_IMqAAAAACqsjZRjjPqwZe4ubnRpnOtMZ8o-"></script>
</body>
</html>